[build]
builder = "nixpacks"
# ビルドプロセスをより詳細に
buildCommand = "cd backend && npm install && npx prisma generate && rm -rf dist && npm run build && ls -la && ls -la dist || echo 'dist不見つかり'"

[deploy]
# 起動前にさらに詳細な情報を確認
startCommand = "cd backend && pwd && find . -name \"server.js\" && (npx prisma migrate deploy || npx prisma db push --accept-data-loss) && node dist/server.js"

[nixpacks]
workdir = "backend"

[nixpacks.env]
NODE_VERSION = "18"