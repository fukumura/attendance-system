[build]
builder = "nixpacks"
# Node.jsを明示的に指定
buildCommand = "cd backend && npm install && npx prisma generate && npm run build"
watchPatterns = ["backend/**"]

[deploy]
startCommand = "cd backend && (npx prisma migrate deploy || npx prisma db push --accept-data-loss) && node dist/server.js"
restartPolicyType = "ON_FAILURE"
numReplicas = 1

[nixpacks]
workdir = "backend"

# Node.js環境を明示的に指定
[nixpacks.build.env]
NODE_VERSION = "18"
