[build]
builder = "nixpacks"
# ビルド時に依存関係のインストール、Prisma生成、ビルドを行う
buildCommand = "cd backend && npm install && npx prisma generate && npx tsc --skipLibCheck"
watchPatterns = ["backend/**"]

[deploy]
# デプロイ時にマイグレーションを適用してからアプリケーションを起動
startCommand = "cd backend && (npx prisma migrate deploy || npx prisma db push --accept-data-loss) && node dist/server.js"
restartPolicyType = "ON_FAILURE"
numReplicas = 1

[nixpacks]
workdir = "backend"
